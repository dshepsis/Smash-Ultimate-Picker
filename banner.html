<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" href="ico.ico" />
  <title>Ultimate Banner Maker</title>
<style>
* {
  margin: 0;
  box-sizing: border-box;
}
html {
  height: 100%;
}
body {
  display: flex;
  justify-content: center;
  align-items: center;
  max-height: 100%;
  max-width: 100%;
  padding: 10px;
}

#hdr {
  flex: 1 1;
  text-align: center;
  min-width: 150px;
  overflow: auto;
  overflow-wrap: break-word
}
#share {
  flex: 1 1;
  overflow: hidden;
  min-width: 150px;
}
#url {
  width: 100%;
  overflow: auto;
}
#grid {
  width: calc(100vmin - 20px);
  height: calc(100vmin - 100px);
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  grid-template-rows: repeat(9, 1fr);
  padding: 0;
  flex: 0 0 auto;
}

img {
  width: 100%;
  height: auto;
  display: block;
}
.img-cont {
  overflow: visible;
  position: relative;
}
.img-cont::before {
  border-radius: 50%;
  border: 8px solid transparent;
  content: "";
  position: absolute;
  z-index: -1;
  top: 2px;
  bottom: 2px;
  left: 2px;
  right: 2px;
}
.img-cont.sel::before {
  border-color: red;
}

/* Overwriting styles: */
body {
  display: flex;
  flex-flow: column nowrap;
  align-items: center;
  background-color: #222;
  overflow: hidden;
  height: 100%;
}
img {
  width: 100%;
  height: auto;
  display: block;
  filter: grayscale(1) contrast(200%) opacity(0.7);
}
#grid {
  width: 100%;
  height: auto;
  grid-template-columns: repeat(14, 1fr);
  grid-template-rows: auto;
  flex: 0 0 auto;
}

#options {
  margin: auto;
  margin-top: 60px;
  display: flex;
  flex-flow: column nowrap;
  align-items: center;
  width: 60%;
  padding: 10px;
  overflow-y: auto;
  overflow-x: hidden;
}
#options * {
  font-size: 24px;
}
#options > * {
  display: block;
  width: 100%;
  flex: 0 0 auto;
}
#options > *+* {
  margin-top: 10px;
}
#rot-left, #rot-right {
  /* display: inline-block; */
  width: 50%;
}
</style>
</head>

<body>
  <div id="grid">
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mario.png" alt="Mario" title="Mario"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/luigi.png" alt="Luigi" title="Luigi"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/peach.png" alt="Peach" title="Peach"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/daisy.png" alt="Daisy" title="Daisy"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bowser.png" alt="Bowser" title="Bowser"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/dr_mario.png" alt="Dr. Mario" title="Dr. Mario"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/rosalina_and_luma.png" alt="Rosalina &amp; Luma" title="Rosalina &amp; Luma"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bowser_jr.png" alt="Bowser Jr." title="Bowser Jr."/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/donkey_kong.png" alt="Donkey Kong" title="Donkey Kong"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/diddy_kong.png" alt="Diddy Kong" title="Diddy Kong"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/king_k_rool.png" alt="King K. Rool" title="King K. Rool"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/link.png" alt="Link" title="Link"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/sheik.png" alt="Sheik" title="Sheik"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/zelda.png" alt="Zelda" title="Zelda"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/young_link.png" alt="Young Link" title="Young Link"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ganondorf.png" alt="Ganondorf" title="Ganondorf"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/toon_link.png" alt="Toon Link" title="Toon Link"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/samus.png" alt="Samus" title="Samus"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/dark_samus.png" alt="Dark Samus" title="Dark Samus"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/zero_suit_samus.png" alt="Zero Suit Samus" title="Zero Suit Samus"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ridley.png" alt="Ridley" title="Ridley"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/yoshi.png" alt="Yoshi" title="Yoshi"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/kirby.png" alt="Kirby" title="Kirby"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/meta_knight.png" alt="Meta Knight" title="Meta Knight"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/king_dedede.png" alt="King Dedede" title="King Dedede"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/fox.png" alt="Fox" title="Fox"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/falco.png" alt="Falco" title="Falco"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wolf.png" alt="Wolf" title="Wolf"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pikachu.png" alt="Pikachu" title="Pikachu"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/jigglypuff.png" alt="Jigglypuff" title="Jigglypuff"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pichu.png" alt="Pichu" title="Pichu"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mewtwo.png" alt="Mewtwo" title="Mewtwo"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pokemon_trainer.png" alt="Pokémon Trainer" title="Pokémon Trainer"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucario.png" alt="Lucario" title="Lucario"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/greninja.png" alt="Greninja" title="Greninja"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ness.png" alt="Ness" title="Ness"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucas.png" alt="Lucas" title="Lucas"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/captain_falcon.png" alt="Captain Falcon" title="Captain Falcon"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ice_climbers.png" alt="Ice Climbers" title="Ice Climbers"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/marth.png" alt="Marth" title="Marth"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucina.png" alt="Lucina" title="Lucina"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/roy.png" alt="Roy" title="Roy"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/chrom.png" alt="Chrom" title="Chrom"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ike.png" alt="Ike" title="Ike"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/robin.png" alt="Robin" title="Robin"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/corrin.png" alt="Corrin" title="Corrin"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mr_game_and_watch.png" alt="Mr. Game &amp; Watch" title="Mr. Game &amp; Watch"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pit.png" alt="Pit" title="Pit"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/dark_pit.png" alt="Dark Pit" title="Dark Pit"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/palutena.png" alt="Palutena" title="Palutena"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wario.png" alt="Wario" title="Wario"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/snake.png" alt="Snake" title="Snake"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/sonic.png" alt="Sonic" title="Sonic"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/olimar.png" alt="Olimar" title="Olimar"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/rob.png" alt="R.O.B." title="R.O.B."/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/villager.png" alt="Villager" title="Villager"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mega_man.png" alt="Mega Man" title="Mega Man"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wii_fit_trainer.png" alt="Wii Fit Yrainer" title="Wii Fit Yrainer"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/little_mac.png" alt="Little Mac" title="Little Mac"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mii_fighter.png" alt="Mii Fighter" title="Mii Fighter"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pac_man.png" alt="Pac-Man" title="Pac-Man"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/shulk.png" alt="Shulk" title="Shulk"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/duck_hunt.png" alt="Duck Hunt" title="Duck Hunt"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ryu.png" alt="Ryu" title="Ryu"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/cloud.png" alt="Cloud" title="Cloud"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bayonetta.png" alt="Bayonetta" title="Bayonetta"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/inkling.png" alt="Inkling" title="Inkling"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/simon.png" alt="Simon" title="Simon"/>
		<img src="https://www.smashbros.com/assets_v2/img/fighter/pict/richter.png" alt="Richter" title="Richter"/>
    <img src="random_char.png" alt="Random" title="Random"/ />
  </div>

  <div id="options">
    <button id="randomize">Randomize</button>
    <div><button id="rot-left">Rotate Left</button><button id="rot-right">Rotate Right</button></div>
    <input id="bg-color" placeholder="Background color" type='text' />
    <input id="circle-color" placeholder="Circle color" type='text' />
    <input id="image-filter" placeholder="Image filter" type='text' />
    <input id="sel-filter" placeholder="Selected filter" type='text' />
  </div>



  <style id="pseudo-style"></style>
<script>
const grid = document.getElementById('grid');
const urlOut = document.getElementById('url');
const shareButton = document.getElementById('shbtn');
const active = new Set();

const queryData = {_: []};
const modifiedQueryData = {_: []};
function writeQuery() {
  const loc = window.location;
  const base = loc.href.replace(loc.search, '');
  const newQueries = [];

  /* Copy info from the original query data and the data modified in-session: */
  const totalQueryData = Object.assign({}, queryData, modifiedQueryData);
  totalQueryData._.push(...queryData._.slice(modifiedQueryData._.length));

  for (const key of Object.keys(totalQueryData).sort()) {
    if (key === '_') {
      /* Filter out empty, null, or undefined data: */
      const keylessData = totalQueryData._.filter(s=>!!s);
      newQueries.push(...keylessData);
    } else {
      newQueries.push(`${key}=${totalQueryData[key]}`);
    }
  }
  if (newQueries.length === 0) return base;
  const newQueryStr = newQueries.join('&');
  if (newQueryStr.length === 0) return base;
  else return `${base}?${newQueryStr}`;
}
window.addEventListener('load', (e)=>{
  const queryStr = window.location.search;
  if (queryStr) {
    const queries = queryStr.substr(1).split('&');
    for (const kv of queries) {
      const [k, v] = kv.split('=');
      if (!v) queryData._.push(k);
      else queryData[k] = v;
    }
  }
  // urlOut.innerHTML = writeQuery();

  /* Execute query string settings: */
  const querySelection = queryData._[0]
  if (querySelection) {
    const shActive = querySelection
      .split('-')
      .map(Number);
    for (const i of shActive) {
      active.add(i);
      grid.children[i].classList.add('sel');
    }
  }
  if (queryData.title) {
    document.getElementById('hdr').firstChild.innerHTML = decodeURI(queryData.title);
  }
});

function getAncestorWithParent(descendent, parent) {
  let ancestor = descendent;
  let ancParent = ancestor.parentElement;
  while (ancParent !== parent) {
    if (ancParent === null) return null;
    ancestor = ancParent;
    ancParent = ancestor.parentElement;
  }
  return ancestor;
}
function getIndexInParent(elem) {
  let i = 0;
  for (let s = elem.previousElementSibling; s !== null; s = s.previousElementSibling) ++i;
  return i;
}

const sel = (e)=>{
  let imgC = e.target;
  while (!imgC.classList.contains('img-cont')) {
    if (imgC === grid || imgC === null) return;
    imgC = imgC.parentElement;
  }
  const added = imgC.classList.toggle('sel');
  const index = getIndexInParent(getAncestorWithParent(imgC, grid));
  if (added) active.add(index);
  else active.delete(index);

  const activeIndices = Array.from(active.keys());
  if (activeIndices.length > 0) {
    modifiedQueryData._[0] = activeIndices.sort((a, b)=>a - b).join('-');
  } else {
    modifiedQueryData._[0] = undefined;
  }
  // urlOut.innerHTML = writeQuery();
};
grid.addEventListener('mousedown', (e)=>{
  sel(e);
  if (e.detail > 1) e.preventDefault();
});
grid.addEventListener('keypress', (e)=>{
  if (e.key === 'Enter' || e.key === ' ') sel(e);
});


const canAutoCopy = (
  document.queryCommandSupported !== undefined &&
  document.queryCommandSupported('copy')
);
let returnTextTimeout;
if (!canAutoCopy) {
  copyButton.innerHTML = 'Click and press <kbd>ctrl+c</kbd> to share!';
}
// const origText = shareButton.innerHTML;
// shareButton.addEventListener('click', (e)=>{
//   const range = document.createRange();
//   range.selectNodeContents(urlOut);
//   const selection = window.getSelection();
//   selection.removeAllRanges();
//   selection.addRange(range);
//
//   if (canAutoCopy) {
//     document.execCommand('copy');
//     shareButton.innerText = "Copied!";
//     if (returnTextTimeout !== undefined) {
//       window.clearTimeout(returnTextTimeout);
//     }
//     returnTextTimeout = window.setTimeout(function() {
//       shareButton.innerText = origText;
//     }, 1000);
//   }
// }, false);

// const header = document.getElementById('hdr');
// header.addEventListener('mousedown', (e)=>{
//   if (e.detail > 1) header.setAttribute('contentEditable', '');
// });
// header.addEventListener('input', (e)=>{
//   modifiedQueryData.title = encodeURI(header.innerText.trim());
//   urlOut.innerHTML = writeQuery();
// })

/* Wrap all images and make them tab-navigable: */
for (let i = 0, len = grid.children.length; i < len; ++i) {
  const img = grid.children[i]
  img.tabIndex = '0';
  const wrapper = document.createElement('div');
  wrapper.classList.add('img-cont');
  img.parentNode.insertBefore(wrapper, img.nextSibling);
  wrapper.appendChild(img);
}

const randButton = document.getElementById('randomize');
randButton.addEventListener('click', ()=>{
  const children = grid.children;
  const len = children.length;
  for (let i = 0; i < len; ++i) {
    const randIndex = Math.floor(Math.random() * (len - i));
    grid.appendChild(children[randIndex]);
  }
});
const rotLeft = document.getElementById('rot-left');
const rotRight = document.getElementById('rot-right');
rotLeft.addEventListener('click', ()=>{
  grid.appendChild(grid.firstElementChild)
});
rotRight.addEventListener('click', ()=>{
  grid.insertBefore(grid.lastElementChild, grid.firstElementChild)
});

const pseudoStyle = document.getElementById('pseudo-style');
const setExtraStyle = (()=>{
  const styles = {};
  return (label, rule)=>{
    styles[label] = rule;
    pseudoStyle.innerHTML = Object.entries(styles).map(([label, rule])=>{
      return `/* ${label} */\n${rule}`
    }).join('\n');
  }
})();
const styleOnInput = (label, rule)=>{
  return e => {
    const sanitizedVal = /^[^\n;{}]*/.exec(e.target.value)[0];
    setExtraStyle(label, rule(sanitizedVal));
  }
}

const bgColor = document.getElementById('bg-color');
bgColor.addEventListener('input', styleOnInput(
  "Background Color",
  color => `body {background: ${color};}`
));

const circleColor = document.getElementById('circle-color');
circleColor.addEventListener('input', styleOnInput(
  "Circle Color",
  color => `.img-cont.sel::before {border-color: ${color};}`
));

const imageFilter = document.getElementById('image-filter');
imageFilter.addEventListener('input', styleOnInput(
  "Image Filter",
  filter => `img {filter: ${filter};}`
));
const selFilter = document.getElementById('sel-filter');
selFilter.addEventListener('input', styleOnInput(
  "Selected Filter",
  filter => `.img-cont.sel img {filter: ${filter};}`
));


</script>
</body>

</html>
