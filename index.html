<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="shortcut icon" href="ico.ico" />
  <title>Ultimate Fighter Picker</title>
<style>
* {
  margin: 0;
  box-sizing: border-box;
}
body {
  display: flex;
  justify-content: center;
  align-items: center;
  max-height: 100%;
  max-width: 100%;
  padding: 10px;
}

#hdr {
  flex: 1 1;
  text-align: center;
  min-width: 150px;
  overflow: auto;
  overflow-wrap: break-word
}
#share {
  flex: 1 1;
  overflow: hidden;
  min-width: 150px;
}
#url {
  width: 100%;
  overflow: auto;
}
#grid {
  width: calc(100vmin - 20px);
  height: calc(100vmin - 20px);
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-gap: 2px;
  padding: 0;
  flex: 0 0 auto;
  margin: 0 10px;
}

img {
  width: 100%;
  height: auto;
  display: block;
}
.img-cont {
  overflow: visible;
  position: relative;
}
.img-cont::before {
  border-radius: 50%;
  border: 8px solid transparent;
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.img-cont.sel::before {
  border-color: red;
}

body {
  flex-flow: row wrap;
}
</style>
</head>

<body>
  <div id="hdr"><h1>Choose your fighters!</h1></div>
  <div id="grid">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mario.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/luigi.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/peach.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/daisy.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bowser.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/dr_mario.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/rosalina_and_luma.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bowser_jr.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/donkey_kong.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/diddy_kong.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/link.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/sheik.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/zelda.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/young_link.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ganondorf.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/toon_link.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/samus.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/zero_suit_samus.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ridley.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/yoshi.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/kirby.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/meta_knight.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/king_dedede.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/fox.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/falco.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wolf.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pikachu.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/jigglypuff.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pichu.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mewtwo.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pokemon_trainer.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucario.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/greninja.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ness.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucas.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/captain_falcon.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ice_climbers.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/marth.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/lucina.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/roy.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ike.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/robin.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/corrin.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mr_game_and_watch.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pit.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/dark_pit.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/palutena.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wario.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/snake.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/sonic.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/olimar.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/rob.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/villager.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mega_man.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/wii_fit_trainer.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/little_mac.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/mii_fighter.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/pac_man.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/shulk.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/duck_hunt.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/ryu.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/cloud.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/bayonetta.png" alt="">
    <img src="https://www.smashbros.com/assets_v2/img/fighter/pict/inkling.png" alt="">
  </div>
  <div id="share"><button id="shbtn">Share</button><pre id="url"></pre></div>

<script>
const grid = document.getElementById('grid');
const urlOut = document.getElementById('url');
const shareButton = document.getElementById('shbtn');
const active = new Set();

const queryData = {_: []};
const modifiedQueryData = {_: []};
function writeQuery() {
  const loc = window.location;
  const base = loc.href.replace(loc.search, '');
  const newQueries = [];

  /* Copy info from the original query data and the data modified in-session: */
  const totalQueryData = Object.assign({}, queryData, modifiedQueryData);
  totalQueryData._.push(...queryData._.slice(modifiedQueryData._.length));

  for (const key of Object.keys(totalQueryData)) {
    if (key === '_') newQueries.push(...totalQueryData._);
    else newQueries.push(`${key}=${totalQueryData[key]}`);
  }
  if (newQueries.length === 0) return base;
  else return `${base}?${newQueries.join('&')}`;
}
window.addEventListener('load', (e)=>{
  const queryStr = window.location.search;
  const queries = queryStr.substr(1).split('&');
  for (const kv of queries) {
    const [k, v] = kv.split('=');
    if (!v) queryData._.push(k);
    else queryData[k] = v;
  }

  urlOut.innerHTML = writeQuery();

  /* Execute query string settings: */
  const querySelection = queryData._[0]
  if (querySelection) {
    const shActive = querySelection
    .split('-')
    .map(Number);
    for (const i of shActive) {
      active.add(i);
      grid.children[i].classList.add('sel');
    }
  }
  if (queryData.title) {
    document.getElementById('hdr').firstChild.innerHTML = decodeURI(queryData.title);
  }
});

function getAncestorWithParent(descendent, parent) {
  let ancestor = descendent;
  let ancParent = ancestor.parentElement;
  while (ancParent !== parent) {
    if (ancParent === null) return null;
    ancestor = ancParent;
    ancParent = ancestor.parentElement;
  }
  return ancestor;
}
function getIndexInParent(elem) {
  let i = 0;
  for (let s = elem.previousElementSibling; s !== null; s = s.previousElementSibling) ++i;
  return i;
}

const sel = (e)=>{
  let imgC = e.target;
  while (!imgC.classList.contains('img-cont')) {
    if (imgC === grid || imgC === null) return;
    imgC = imgC.parentElement;
  }
  const added = imgC.classList.toggle('sel');
  const index = getIndexInParent(getAncestorWithParent(imgC, grid));
  if (added) active.add(index);
  else active.delete(index);
  modifiedQueryData._[0] = Array.from(active.keys()).join('-');
  urlOut.innerHTML = writeQuery();
};
grid.addEventListener('mousedown', (e)=>{
  sel(e);
  if (e.detail > 1) e.preventDefault();
});
grid.addEventListener('keypress', (e)=>{
  if (e.key === 'Enter' || e.key === ' ') sel(e);
});


const canAutoCopy = (
  document.queryCommandSupported !== undefined &&
  document.queryCommandSupported('copy')
);
let returnTextTimeout;
if (!canAutoCopy) {
  copyButton.innerHTML = 'Click and press <kbd>ctrl+c</kbd> to share!';
}
const origText = shareButton.innerHTML;
shareButton.addEventListener('click', (e)=>{
  const range = document.createRange();
  range.selectNodeContents(urlOut);
  const selection = window.getSelection();
  selection.removeAllRanges();
  selection.addRange(range);

  if (canAutoCopy) {
    document.execCommand('copy');
    shareButton.innerText = "Copied!";
    if (returnTextTimeout !== undefined) {
      window.clearTimeout(returnTextTimeout);
    }
    returnTextTimeout = window.setTimeout(function() {
      shareButton.innerText = origText;
    }, 1000);
  }
}, false);

const header = document.getElementById('hdr');
header.addEventListener('mousedown', (e)=>{
  if (e.detail > 1) header.setAttribute('contentEditable', '');
});
header.addEventListener('input', (e)=>{
  modifiedQueryData.title = encodeURI(header.innerText.trim());
  urlOut.innerHTML = writeQuery();
})

/* Wrap all images and make them tab-navigable: */
for (let i = 0, len = grid.children.length; i < len; ++i) {
  const img = grid.children[i]
  img.tabIndex = '0';
  const wrapper = document.createElement('div');
  wrapper.classList.add('img-cont');
  img.parentNode.insertBefore(wrapper, img.nextSibling);
  wrapper.appendChild(img);
}
</script>
</body>

</html>
